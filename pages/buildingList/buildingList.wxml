<!--buildingList.wxml-->
<view class="building-list-container" :style="background:{{ backUrl }}">
  <view class="watermark-box">
    <canvas canvas-id="watermark" style='width:100%;height:100vh;'></canvas>
  </view>
  <view class="search-box">
    <view class="share-btn-icon-box btn-set-box" bindtap="showPopup">
      <van-icon name="filter-o" color="#808080" size="48rpx" />
    </view>
    <view class="search-con">
      {{ title }}
      <view>
        {{ payType }}
      </view>
    </view>
    <view class="share-btn-icon-box" bindtap="onShare">
      <image src="../../assets/images/pagesIcon/share.png" class="share-btn-icon" />
    </view>
  </view>
  <view class="sale-ad-box">
    <view class="sale-box">
      <view class="salesperson-profile-photo">
        <image src="../../assets/images/buildingList/salesperson.jpg" alt="" />
        <view bindtap="sendMessage">咨询</view>
      </view>
      <view class="sale-feature-list">
        <view class="salesperson-info">
          <view class="salesperson-name"> {{ salespersonName }} </view>
          <view class="salesperson-level"> {{ salespersonLevel }} </view>
        </view>
        <view class="salesperson-serve">
          <view class="salesperson-title" wx:for="{{ salespersonTitle }}" wx:key="index"> {{ item }} </view>
        </view>
      </view>
      <view class="our-ewm">
        <image src="../../assets/images/buildingList/salesperson.jpg" alt="" />
      </view>
    </view>
  </view>
  <view class="building-table-box">
    <view class="table-head">
      <view wx:for="{{ defualtChar }}" wx:key="index" data-idx="{{ index }}" bindtap="sortChar">
        {{ item.name }}
        <van-icon name="arrow-up" wx:if="{{ tapChar === index && sortUp }}" />
        <van-icon name="arrow-down" wx:if="{{ tapChar === index && !sortUp }}" />
      </view>
    </view>
    <view class="table-box">
      <scroll-view scroll-y lower-threshold="100" bindscrolltolower="scrollToLower" style="height:100%">
        <view wx:for="{{ tableData }}" class="table-con" wx:for-index="idx" wx:for-item="item" wx:key="idx">
          <view class="table" wx:key="index" >
            {{ item.floor }}
          </view>
          <view class="table" wx:key="index" >
            {{ item.area }}
          </view>
          <view class="table" wx:key="index" >
            {{ item.total }}
          </view>
          <view class="table" wx:key="index" >
            {{ item.price }}
          </view>
          <view class="table" wx:key="index" >
            {{ item.houseType }}
          </view>
          <view class="table" wx:key="index" >
            {{ item.sun }}
          </view>
        </view>
        <view style="text-align: center;margin: 10px;">
          <view wx:if="{{ loading }}">加载中...</view>
          <view wx:if="{{ noMore }}">没有更多了</view>
          <view wx:if="{{ loadingFailed }}" bindtap="scrollToLower">数据加载失败,请点击此处重新加载</view>
        </view>
      </scroll-view>
      <view class="noPay" wx:if="{{ noPay }}">
        <button type="primary">联系销售获取此楼盘码</button>
      </view>
    </view>
  </view>
  <van-popup
    round
    closeable
    close-icon="close"
    show="{{ show }}"
    position="bottom"
    custom-class="house-condition-check"
    bind:close="closePopup"
    bind:click-overlay="closePopup"
  >
    <view class="house-condition-box">
      <view class="house-condition-title">
        选择条件过滤
      </view>
      <view class="house-condition">
        <scroll-view scroll-y lower-threshold="100" style="height:100%" class="house-condition-con">
          <van-checkbox-group value="{{ result }}" bind:change="onConditionChange">
            <van-cell-group>
              <view
                wx:for="{{ conditionArr }}"
                wx:key="index"
              >
                <van-cell
                  title="{{ item.title }}"
                  value-class="value-class"
                  clickable
                  bind:click="toggle"
                  data-index="{{index}}"
                >
                  <van-checkbox
                    catch:tap="noop"
                    class="checkboxes-{{ index }}"
                    name="{{ index }}"
                  />
                </van-cell>
                <view wx:if="{{ item.type === 'checkbox' }}">
                  <van-checkbox-group wx:if="{{ item.checked }}" value="{{ item.value }}" direction="horizontal" data-key="{{ item.key }}" bind:change="onCheckChange">
                    <van-checkbox
                      custom-class="check-box"
                      wx:for="{{ item.conditionData.list }}"
                      wx:for-index="checkIdx"
                      wx:for-item="check"
                      wx:key="checkIdx"
                      name="{{ check.name }}"
                    >{{ check.label }}</van-checkbox>
                  </van-checkbox-group>
                </view>
                <view wx:if="{{ item.type === 'input' }}">
                  <view class='input-box' wx:if="{{ item.checked }}">
                    <van-field
                      type="number"
                      wx:for="{{ item.conditionData.list }}"
                      wx:for-item="input"
                      wx:for-index="inputIdx"
                      wx:key="inputIdx"
                      model:value="{{ item.value[inputIdx] }}"
                      label="{{ input.label }}(元):"
                      placeholder="请输入{{ input.label }}"
                      border="{{ true }}"
                      data-key="{{ item.key }}"
                      data-idx="{{ inputIdx }}"
                      bind:confirm="onInputChange"
                      bind:input="onInputChange"
                    />
                  </view>
                </view>
              </view>
            </van-cell-group>
          </van-checkbox-group>
        </scroll-view>
      </view>      
      <view class="house-condition-btn">
        <view class="reset-btn">
          <van-button type="warning" size="small" round bind:click="" custom-style="width:200rpx;height: 70rpx;line-height: 70rpx;"> 重 置 </van-button>
        </view>
        <view class="confirm-btn">
          <van-button type="primary" size="small" round bind:click="getHouseList" custom-style="width:200rpx;height: 70rpx;line-height: 70rpx;"> 确 定 </van-button>
        </view>
      </view>
    </view>
  </van-popup>
  <van-share-sheet show="{{ showShare }}" cancel-text="取消" title="立即分享给好友" options="{{ options }}" bind:select="onSelect" bind:close="onClose" />
  <van-toast id="van-toast" />
</view>
